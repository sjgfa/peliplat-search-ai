<!DOCTYPE html>
<html>
<head>
    <title>AIæœç´¢æµ‹è¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .query { font-weight: bold; color: #2196F3; }
        .result { background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 3px; }
        .step { margin: 5px 0; padding: 5px; background: #e3f2fd; border-radius: 3px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        .loading { color: #ff9800; }
        .completed { color: #4caf50; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <h1>ğŸ¤– AIç”µå½±æœç´¢æµ‹è¯•</h1>
    
    <div class="test-case">
        <h3>æµ‹è¯•æ¡ˆä¾‹1ï¼šæè¿°æ€§æŸ¥è¯¢</h3>
        <div class="query">æˆ‘æƒ³çœ‹é»„è‰²æµ·ç»µçš„ç”µå½±</div>
        <button onclick="testQuery('æˆ‘æƒ³çœ‹é»„è‰²æµ·ç»µçš„ç”µå½±', 'test1')">æµ‹è¯•</button>
        <div id="test1" class="result"></div>
    </div>
    
    <div class="test-case">
        <h3>æµ‹è¯•æ¡ˆä¾‹2ï¼šè‹±é›„ç”µå½±</h3>
        <div class="query">æ¨èä¸€äº›èœ˜è››ä¾ ç”µå½±</div>
        <button onclick="testQuery('æ¨èä¸€äº›èœ˜è››ä¾ ç”µå½±', 'test2')">æµ‹è¯•</button>
        <div id="test2" class="result"></div>
    </div>
    
    <div class="test-case">
        <h3>æµ‹è¯•æ¡ˆä¾‹3ï¼šç±»å‹æœç´¢</h3>
        <div class="query">sci-fi movies 2023</div>
        <button onclick="testQuery('sci-fi movies 2023', 'test3')">æµ‹è¯•</button>
        <div id="test3" class="result"></div>
    </div>
    
    <div class="test-case">
        <h3>è‡ªå®šä¹‰æŸ¥è¯¢</h3>
        <input type="text" id="customQuery" placeholder="è¾“å…¥æ‚¨çš„æŸ¥è¯¢..." style="width: 300px; padding: 8px;">
        <button onclick="testCustomQuery()">æµ‹è¯•</button>
        <div id="customResult" class="result"></div>
    </div>

    <script>
        function testQuery(query, resultId) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.innerHTML = '<div class="loading">ğŸ”„ æ­£åœ¨æœç´¢...</div>';
            
            const encodedQuery = encodeURIComponent(query);
            const eventSource = new EventSource(`/api/movie-tool/smart-search?query=${encodedQuery}`);
            
            let steps = [];
            let startTime = Date.now();
            
            eventSource.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'step') {
                        steps.push(`<div class="step">${data.title} - ${data.status}</div>`);
                        updateResult(resultDiv, steps, `æ‰§è¡Œä¸­... (${Math.round((Date.now() - startTime)/1000)}ç§’)`);
                    } else if (data.type === 'progress') {
                        steps.push(`<div class="step">ğŸ“‹ ${data.message}</div>`);
                        if (data.intent) steps.push(`<div class="step">ğŸ¯ æ„å›¾: ${data.intent}</div>`);
                        if (data.keywords) steps.push(`<div class="step">ğŸ”‘ å…³é”®è¯: ${data.keywords.join(', ')}</div>`);
                        updateResult(resultDiv, steps, `åˆ†æä¸­...`);
                    } else if (data.type === 'complete') {
                        const result = data.result;
                        const movies = result.movies || [];
                        const executionTime = Math.round((Date.now() - startTime)/1000);
                        
                        steps.push(`<div class="step completed">âœ… å®Œæˆï¼æ‰¾åˆ° ${movies.length} éƒ¨ç”µå½± (${executionTime}ç§’)</div>`);
                        
                        if (movies.length > 0) {
                            steps.push('<div class="step"><strong>å‰3éƒ¨ç”µå½±ï¼š</strong></div>');
                            movies.slice(0, 3).forEach((movie, i) => {
                                steps.push(`<div class="step">${i+1}. ${movie.title} (${movie.publicationYear || 'N/A'})</div>`);
                            });
                        }
                        
                        updateResult(resultDiv, steps, '');
                        eventSource.close();
                    } else if (data.type === 'error') {
                        steps.push(`<div class="step error">âŒ é”™è¯¯: ${data.error}</div>`);
                        updateResult(resultDiv, steps, '');
                        eventSource.close();
                    }
                } catch (e) {
                    console.error('è§£æå“åº”å¤±è´¥:', e);
                }
            };
            
            eventSource.onerror = function(event) {
                steps.push(`<div class="step error">âŒ è¿æ¥é”™è¯¯</div>`);
                updateResult(resultDiv, steps, '');
                eventSource.close();
            };
        }
        
        function updateResult(resultDiv, steps, status) {
            resultDiv.innerHTML = steps.join('') + (status ? `<div class="loading">${status}</div>` : '');
        }
        
        function testCustomQuery() {
            const query = document.getElementById('customQuery').value.trim();
            if (query) {
                testQuery(query, 'customResult');
            }
        }
    </script>
</body>
</html>